name: CI Linux

on:
  push:
    branches: [ main, master, dev ]
  pull_request:
    branches: [ main, master, dev ]

jobs:
  build-core:
    name: Core (Linux)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies (Linux)
        run: |
          sudo apt-get update
          sudo apt-get install -y libgl-dev libx11-dev libxrandr-dev libxinerama-dev \
                                  libxcursor-dev libxi-dev libxext-dev libwayland-dev \
                                  libxkbcommon-dev

      - name: Configure CMake (Core only)
        shell: bash
        run: |
          cmake -B build -S . \
            -DCMAKE_BUILD_TYPE=Release \
            -DVNM_PLOT_CORE_ONLY=ON \
            -DVNM_PLOT_ENABLE_TEXT=OFF

      - name: Build core library
        run: cmake --build build --config Release

      - name: Build summary
        shell: bash
        run: |
          echo "=== Build completed ==="
          ls -la build/*.a 2>/dev/null || echo "Static libraries in build directory"

  build-standalone-example:
    name: GLFW Example (Linux)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies (Linux)
        run: |
          sudo apt-get update
          sudo apt-get install -y libgl-dev libx11-dev libxrandr-dev libxinerama-dev \
                                  libxcursor-dev libxi-dev libxext-dev libwayland-dev \
                                  libxkbcommon-dev

      - name: Configure CMake (standalone_glfw)
        shell: bash
        working-directory: examples/standalone_glfw
        run: |
          cmake -B build -S . \
            -DCMAKE_BUILD_TYPE=Release \
            -DVNM_PLOT_BUILD_QT=OFF \
            -DVNM_PLOT_ENABLE_TEXT=OFF

      - name: Build standalone_glfw example
        working-directory: examples/standalone_glfw
        run: cmake --build build --config Release

      - name: Verify executable
        shell: bash
        working-directory: examples/standalone_glfw
        run: |
          echo "=== Build completed ==="
          ls -la build/standalone_glfw 2>/dev/null || echo "Executable built successfully"

  build-core-with-text:
    name: Core+Text (Linux)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies (Linux)
        run: |
          sudo apt-get update
          sudo apt-get install -y libgl-dev libx11-dev libxrandr-dev libxinerama-dev \
                                  libxcursor-dev libxi-dev libxext-dev libwayland-dev \
                                  libxkbcommon-dev

      - name: Configure CMake (Core with text)
        shell: bash
        run: |
          cmake -B build -S . \
            -DCMAKE_BUILD_TYPE=Release \
            -DVNM_PLOT_CORE_ONLY=ON \
            -DVNM_PLOT_ENABLE_TEXT=ON

      - name: Build core library with text
        run: cmake --build build --config Release

      - name: Build summary
        shell: bash
        run: |
          echo "=== Build completed (with text rendering) ==="
          ls -la build/*.a 2>/dev/null || echo "Static libraries built"
